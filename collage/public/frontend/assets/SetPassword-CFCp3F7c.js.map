{"version":3,"file":"SetPassword-CFCp3F7c.js","sources":["../../../../frontend/src/components/SetPassword.vue"],"sourcesContent":["<template>\n  <section class=\"reset-password\">\n    <div class=\"card\">\n      <h2>Reset Password</h2>\n\n      <form @submit.prevent=\"handleSubmit\">\n        <!-- Old password (only if no key is present) -->\n        <div v-if=\"!key\">\n          <input\n            v-model=\"oldPassword\"\n            type=\"password\"\n            placeholder=\"Old Password\"\n            autocomplete=\"current-password\"\n          />\n        </div>\n\n        <!-- New password -->\n        <div>\n          <input\n            v-model=\"newPassword\"\n            type=\"password\"\n            placeholder=\"New Password\"\n            autocomplete=\"new-password\"\n          />\n        </div>\n\n        <!-- Confirm password -->\n        <div>\n          <input\n            v-model=\"confirmPassword\"\n            type=\"password\"\n            placeholder=\"Confirm Password\"\n            autocomplete=\"new-password\"\n          />\n        </div>\n\n        <!-- Messages -->\n        <p v-if=\"errorMessage\" class=\"error\">{{ errorMessage }}</p>\n        <p v-if=\"successMessage\" class=\"success\">{{ successMessage }}</p>\n\n        <button type=\"submit\" :disabled=\"loading\">\n          {{ loading ? \"Updating...\" : \"Confirm\" }}\n        </button>\n      </form>\n    </div>\n  </section>\n</template>\n\n<script setup>\nimport { ref, watch } from \"vue\"\nimport { useRoute } from \"vue-router\"\n\n// state\nconst route = useRoute()\nconst key = ref(route.query.key || \"\")\nconst user = ref(route.query.user || \"\")\nconst oldPassword = ref(\"\")\nconst newPassword = ref(\"\")\nconst confirmPassword = ref(\"\")\nconst loading = ref(false)\nconst errorMessage = ref(\"\")\nconst successMessage = ref(\"\")\n\n// Watch if URL query changes\nwatch(\n  () => route.query,\n  (q) => {\n    key.value = q.key || \"\"\n    user.value = q.user || \"\"\n  },\n  { immediate: true }\n)\n\n// Submit handler\nconst handleSubmit = async () => {\n  errorMessage.value = \"\"\n  successMessage.value = \"\"\n\n  if (!newPassword.value) {\n    errorMessage.value = \"Please enter a new password.\"\n    return\n  }\n  if (newPassword.value !== confirmPassword.value) {\n    errorMessage.value = \"Passwords do not match.\"\n    return\n  }\n\n  loading.value = true\n  try {\n    const res = await fetch(\"/api/method/frappe.core.doctype.user.user.update_password\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        key: key.value || \"\",\n        old_password: oldPassword.value,\n        new_password: newPassword.value,\n        confirm_password: confirmPassword.value,\n        logout_all_sessions: 1,\n      }),\n    })\n\n    if (res.status === 200) {\n      const data = await res.json()\n      successMessage.value = \"Password updated successfully!\"\n      console.log(\"Response:\", data)\n      setTimeout(() => {\n        router.push(\"/my-profile\");\n      }, 2000)\n    } else {\n      const err = await res.json()\n      errorMessage.value = err.message || \"Something went wrong.\"\n    }\n  } catch (err) {\n    errorMessage.value = err.message || \"Network error.\"\n  } finally {\n    loading.value = false\n  }\n}\n</script>\n\n<style scoped>\n.reset-password {\n  display: flex;\n  justify-content: center;\n  margin-top: 5rem;\n}\n.card {\n  width: 400px;\n  padding: 2rem;\n  border: 1px solid #ddd;\n  border-radius: 10px;\n}\ninput {\n  width: 100%;\n  padding: 0.5rem;\n  margin-bottom: 1rem;\n}\nbutton {\n  width: 100%;\n  padding: 0.75rem;\n  background: #2563eb;\n  color: white;\n  border: none;\n  border-radius: 5px;\n}\n.error {\n  color: red;\n  font-size: 0.9rem;\n}\n.success {\n  color: green;\n  font-size: 0.9rem;\n}\n</style>\n"],"names":["route","useRoute","key","ref","user","oldPassword","newPassword","confirmPassword","loading","errorMessage","successMessage","watch","q","handleSubmit","__async","res","data","err","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_cache","_hoisted_3","$event","_hoisted_4","_toDisplayString","_hoisted_5","_hoisted_6"],"mappings":"geAqDA,MAAMA,EAAQC,EAAQ,EAChBC,EAAMC,EAAIH,EAAM,MAAM,KAAO,EAAE,EAC/BI,EAAOD,EAAIH,EAAM,MAAM,MAAQ,EAAE,EACjCK,EAAcF,EAAI,EAAE,EACpBG,EAAcH,EAAI,EAAE,EACpBI,EAAkBJ,EAAI,EAAE,EACxBK,EAAUL,EAAI,EAAK,EACnBM,EAAeN,EAAI,EAAE,EACrBO,EAAiBP,EAAI,EAAE,EAG7BQ,EACE,IAAMX,EAAM,MACXY,GAAM,CACLV,EAAI,MAAQU,EAAE,KAAO,GACrBR,EAAK,MAAQQ,EAAE,MAAQ,EACzB,EACA,CAAE,UAAW,EAAI,CACnB,EAGA,MAAMC,EAAe,IAAYC,EAAA,sBAI/B,GAHAL,EAAa,MAAQ,GACrBC,EAAe,MAAQ,GAEnB,CAACJ,EAAY,MAAO,CACtBG,EAAa,MAAQ,+BACrB,MACF,CACA,GAAIH,EAAY,QAAUC,EAAgB,MAAO,CAC/CE,EAAa,MAAQ,0BACrB,MACF,CAEAD,EAAQ,MAAQ,GAChB,GAAI,CACF,MAAMO,EAAM,MAAM,MAAM,4DAA6D,CACnF,OAAQ,OACR,QAAS,CACP,eAAgB,kBACxB,EACM,KAAM,KAAK,UAAU,CACnB,IAAKb,EAAI,OAAS,GAClB,aAAcG,EAAY,MAC1B,aAAcC,EAAY,MAC1B,iBAAkBC,EAAgB,MAClC,oBAAqB,CAC7B,CAAO,CACP,CAAK,EAED,GAAIQ,EAAI,SAAW,IAAK,CACtB,MAAMC,EAAO,MAAMD,EAAI,KAAI,EAC3BL,EAAe,MAAQ,iCACvB,QAAQ,IAAI,YAAaM,CAAI,EAC7B,WAAW,IAAM,CACf,OAAO,KAAK,aAAa,CAC3B,EAAG,GAAI,CACT,KAAO,CACL,MAAMC,EAAM,MAAMF,EAAI,KAAI,EAC1BN,EAAa,MAAQQ,EAAI,SAAW,uBACtC,CACF,OAASA,EAAK,CACZR,EAAa,MAAQQ,EAAI,SAAW,gBACtC,QAAC,CACCT,EAAQ,MAAQ,EAClB,CACF,iBAtHEU,EAAA,EAAAC,EA4CU,UA5CVC,EA4CU,CA3CRC,EA0CM,MA1CNC,EA0CM,CAzCJC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAF,EAAuB,UAAnB,iBAAc,EAAA,GAElBA,EAsCO,OAAA,CAtCA,WAAgBR,EAAY,CAAA,SAAA,CAAA,IAErBX,EAAA,oBAAZiB,EAOM,MAAAK,EAAA,GANJH,EAKE,QAAA,sCAJShB,EAAW,MAAAoB,GACpB,KAAK,WACL,YAAY,eACZ,aAAa,kCAHJpB,EAAA,KAAW,OAQxBgB,EAOM,MAAA,KAAA,GANJA,EAKE,QAAA,sCAJSf,EAAW,MAAAmB,GACpB,KAAK,WACL,YAAY,eACZ,aAAa,8BAHJnB,EAAA,KAAW,MAQxBe,EAOM,MAAA,KAAA,GANJA,EAKE,QAAA,sCAJSd,EAAe,MAAAkB,GACxB,KAAK,WACL,YAAY,mBACZ,aAAa,8BAHJlB,EAAA,KAAe,MAQnBE,EAAA,WAATU,EAA2D,IAA3DO,EAA2DC,EAAnBlB,EAAA,KAAY,EAAA,CAAA,YAC3CC,EAAA,WAATS,EAAiE,IAAjES,EAAiED,EAArBjB,EAAA,KAAc,EAAA,CAAA,YAE1DW,EAES,SAAA,CAFD,KAAK,SAAU,SAAUb,EAAA,SAC5BA,EAAA,MAAO,cAAA,SAAA,EAAA,EAAAqB,CAAA"}